{"ast":null,"code":"import{useContext,useEffect}from\"react\";import MapContext from\"../Map/MapContext\";import OLVectorLayer from\"ol/layer/Vector\";import{Vector as VectorSource}from'ol/source';import{transformExtent}from'ol/proj';import OSMXML from'ol/format/OSMXML';import{bbox as bboxStrategy}from'ol/loadingstrategy';var VectorLayer=function VectorLayer(_ref){var style=_ref.style,_ref$zIndex=_ref.zIndex,zIndex=_ref$zIndex===void 0?0:_ref$zIndex;var _useContext=useContext(MapContext),map=_useContext.map;var source=new VectorSource({format:new OSMXML(),loader:function loader(extent,resolution,projection){var epsg4326Extent=transformExtent(extent,projection,'EPSG:4326');var client=new XMLHttpRequest();client.open('POST','https://overpass-api.de/api/interpreter');client.addEventListener('load',function(){var features=new OSMXML().readFeatures(client.responseText,{featureProjection:map.getView().getProjection()});source.addFeatures(features);});var extended_load_percentage=0.02;var stringExtent=epsg4326Extent[1]-epsg4326Extent[1]*extended_load_percentage+','+(epsg4326Extent[0]*extended_load_percentage+epsg4326Extent[0])+','+(epsg4326Extent[3]*extended_load_percentage+epsg4326Extent[3])+','+(epsg4326Extent[2]-epsg4326Extent[2]*extended_load_percentage);var query=\"(way[building](\"+stringExtent+\");); out meta; >; out meta qt;\";client.send(query);},strategy:bboxStrategy});useEffect(function(){if(!map)return;var vectorLayer=new OLVectorLayer({source:source,style:style});map.addLayer(vectorLayer);vectorLayer.setZIndex(zIndex);return function(){if(map){map.removeLayer(vectorLayer);}};},[map]);return null;};export default VectorLayer;","map":{"version":3,"sources":["/home/enrique/projects/prueba/src/Layers/VectorLayer.js"],"names":["useContext","useEffect","MapContext","OLVectorLayer","Vector","VectorSource","transformExtent","OSMXML","bbox","bboxStrategy","VectorLayer","style","zIndex","map","source","format","loader","extent","resolution","projection","epsg4326Extent","client","XMLHttpRequest","open","addEventListener","features","readFeatures","responseText","featureProjection","getView","getProjection","addFeatures","extended_load_percentage","stringExtent","query","send","strategy","vectorLayer","addLayer","setZIndex","removeLayer"],"mappings":"AAAA,OAASA,UAAT,CAAqBC,SAArB,KAAsC,OAAtC,CACA,MAAOC,CAAAA,UAAP,KAAuB,mBAAvB,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,OAASC,MAAM,GAAIC,CAAAA,YAAnB,KAAuC,WAAvC,CACA,OAASC,eAAT,KAAgC,SAAhC,CACA,MAAOC,CAAAA,MAAP,KAAmB,kBAAnB,CACA,OAASC,IAAI,GAAIC,CAAAA,YAAjB,KAAqC,oBAArC,CAEA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,MAA2B,IAAxBC,CAAAA,KAAwB,MAAxBA,KAAwB,kBAAjBC,MAAiB,CAAjBA,MAAiB,sBAAR,CAAQ,6BAC9BZ,UAAU,CAACE,UAAD,CADoB,CACtCW,GADsC,aACtCA,GADsC,CAG9C,GAAIC,CAAAA,MAAM,CAAG,GAAIT,CAAAA,YAAJ,CAAiB,CAC7BU,MAAM,CAAE,GAAIR,CAAAA,MAAJ,EADqB,CAE7BS,MAAM,CAAE,gBAAUC,MAAV,CAAkBC,UAAlB,CAA8BC,UAA9B,CAA0C,CACjD,GAAIC,CAAAA,cAAc,CAAGd,eAAe,CAACW,MAAD,CAASE,UAAT,CAAqB,WAArB,CAApC,CACA,GAAIE,CAAAA,MAAM,CAAG,GAAIC,CAAAA,cAAJ,EAAb,CACAD,MAAM,CAACE,IAAP,CAAY,MAAZ,CAAoB,yCAApB,EACAF,MAAM,CAACG,gBAAP,CAAwB,MAAxB,CAAgC,UAAY,CAC3C,GAAIC,CAAAA,QAAQ,CAAG,GAAIlB,CAAAA,MAAJ,GAAamB,YAAb,CAA0BL,MAAM,CAACM,YAAjC,CAA+C,CAC7DC,iBAAiB,CAAEf,GAAG,CAACgB,OAAJ,GAAcC,aAAd,EAD0C,CAA/C,CAAf,CAGAhB,MAAM,CAACiB,WAAP,CAAmBN,QAAnB,EACA,CALD,EAMA,GAAIO,CAAAA,wBAAwB,CAAG,IAA/B,CACA,GAAIC,CAAAA,YAAY,CAAIb,cAAc,CAAC,CAAD,CAAd,CAAoBA,cAAc,CAAC,CAAD,CAAd,CAAoBY,wBAAzC,CAAqE,GAArE,EAA4EZ,cAAc,CAAC,CAAD,CAAd,CAAoBY,wBAApB,CAA+CZ,cAAc,CAAC,CAAD,CAAzI,EAAgJ,GAAhJ,EACjBA,cAAc,CAAC,CAAD,CAAd,CAAoBY,wBAApB,CAA+CZ,cAAc,CAAC,CAAD,CAD5C,EACmD,GADnD,EAC0DA,cAAc,CAAC,CAAD,CAAd,CAAoBA,cAAc,CAAC,CAAD,CAAd,CAAoBY,wBADlG,CAAnB,CAEA,GAAIE,CAAAA,KAAK,CAAG,kBAAoBD,YAApB,CAAmC,gCAA/C,CACAZ,MAAM,CAACc,IAAP,CAAYD,KAAZ,EACA,CAjB4B,CAkB7BE,QAAQ,CAAE3B,YAlBmB,CAAjB,CAAb,CAuBAR,SAAS,CAAC,UAAM,CACf,GAAI,CAACY,GAAL,CAAU,OAEV,GAAIwB,CAAAA,WAAW,CAAG,GAAIlC,CAAAA,aAAJ,CAAkB,CACnCW,MAAM,CAANA,MADmC,CAEnCH,KAAK,CAALA,KAFmC,CAAlB,CAAlB,CAKAE,GAAG,CAACyB,QAAJ,CAAaD,WAAb,EACAA,WAAW,CAACE,SAAZ,CAAsB3B,MAAtB,EAEA,MAAO,WAAM,CACZ,GAAIC,GAAJ,CAAS,CACRA,GAAG,CAAC2B,WAAJ,CAAgBH,WAAhB,EACA,CACD,CAJD,CAKA,CAhBQ,CAgBN,CAACxB,GAAD,CAhBM,CAAT,CAkBA,MAAO,KAAP,CACA,CA7CD,CA+CA,cAAeH,CAAAA,WAAf","sourcesContent":["import { useContext, useEffect } from \"react\";\nimport MapContext from \"../Map/MapContext\";\nimport OLVectorLayer from \"ol/layer/Vector\";\nimport { Vector as VectorSource } from 'ol/source';\nimport { transformExtent } from 'ol/proj';\nimport OSMXML from 'ol/format/OSMXML';\nimport { bbox as bboxStrategy } from 'ol/loadingstrategy';\n\nconst VectorLayer = ({ style, zIndex = 0 }) => {\n\tconst { map } = useContext(MapContext);\n\n\tlet source = new VectorSource({\n\t\tformat: new OSMXML(),\n\t\tloader: function (extent, resolution, projection) {\n\t\t\tvar epsg4326Extent = transformExtent(extent, projection, 'EPSG:4326');\n\t\t\tvar client = new XMLHttpRequest();\n\t\t\tclient.open('POST', 'https://overpass-api.de/api/interpreter');\n\t\t\tclient.addEventListener('load', function () {\n\t\t\t\tvar features = new OSMXML().readFeatures(client.responseText, {\n\t\t\t\t\tfeatureProjection: map.getView().getProjection(),\n\t\t\t\t});\n\t\t\t\tsource.addFeatures(features);\n\t\t\t});\n\t\t\tvar extended_load_percentage = 0.02;\n\t\t\tvar stringExtent = (epsg4326Extent[1] - epsg4326Extent[1] * extended_load_percentage) + ',' + (epsg4326Extent[0] * extended_load_percentage + epsg4326Extent[0]) + ',' +\n\t\t\t\t(epsg4326Extent[3] * extended_load_percentage + epsg4326Extent[3]) + ',' + (epsg4326Extent[2] - epsg4326Extent[2] * extended_load_percentage);\n\t\t\tvar query = \"(way[building](\" + stringExtent + \");); out meta; >; out meta qt;\"\n\t\t\tclient.send(query);\n\t\t},\n\t\tstrategy: bboxStrategy,\n\n\t});\n\n\n\tuseEffect(() => {\n\t\tif (!map) return;\n\n\t\tlet vectorLayer = new OLVectorLayer({\n\t\t\tsource,\n\t\t\tstyle\n\t\t});\n\n\t\tmap.addLayer(vectorLayer);\n\t\tvectorLayer.setZIndex(zIndex);\n\n\t\treturn () => {\n\t\t\tif (map) {\n\t\t\t\tmap.removeLayer(vectorLayer);\n\t\t\t}\n\t\t};\n\t}, [map]);\n\n\treturn null;\n};\n\nexport default VectorLayer;"]},"metadata":{},"sourceType":"module"}