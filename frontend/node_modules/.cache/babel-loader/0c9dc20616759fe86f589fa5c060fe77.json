{"ast":null,"code":"/**\n * @module ol/format/IIIFInfo\n */\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport { assert } from '../asserts.js';\n/**\n * @typedef {Object} PreferredOptions\n * @property {string} [format] Preferred image format. Will be used if the image information\n * indicates support for that format.\n * @property {string} [quality] IIIF image qualitiy.  Will be used if the image information\n * indicates support for that quality.\n */\n\n/**\n * @typedef {Object} SupportedFeatures\n * @property {Array<string>} [supports] Supported IIIF image size and region\n * calculation features.\n * @property {Array<string>} [formats] Supported image formats.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n */\n\n/**\n * @typedef {Object} TileInfo\n * @property {Array<number>} scaleFactors Supported resolution scaling factors.\n * @property {number} width Tile width in pixels.\n * @property {number} [height] Tile height in pixels. Same as tile width if height is\n * not given.\n */\n\n/**\n * @typedef {Object} IiifProfile\n * @property {Array<string>} [formats] Supported image formats for the image service.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n * @property {Array<string>} [supports] Supported features.\n * @property {number} [maxArea] Maximum area (pixels) available for this image service.\n * @property {number} [maxHeight] Maximum height.\n * @property {number} [maxWidth] Maximum width.\n */\n\n/**\n * @typedef {Object<string,string|number|Array<number|string|IiifProfile>|Object<string, number>|TileInfo>}\n *    ImageInformationResponse\n */\n\n/**\n * Enum representing the major IIIF Image API versions\n * @enum {string}\n */\n\nexport var Versions = {\n  VERSION1: 'version1',\n  VERSION2: 'version2',\n  VERSION3: 'version3'\n};\n/**\n * Supported image formats, qualities and supported region / size calculation features\n * for different image API versions and compliance levels\n * @const\n * @type {Object<string, Object<string, SupportedFeatures>>}\n */\n\nvar IIIF_PROFILE_VALUES = {};\nIIIF_PROFILE_VALUES[Versions.VERSION1] = {\n  'level0': {\n    supports: [],\n    formats: [],\n    qualities: ['native']\n  },\n  'level1': {\n    supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n    formats: ['jpg'],\n    qualities: ['native']\n  },\n  'level2': {\n    supports: ['regionByPx', 'regionByPct', 'sizeByW', 'sizeByH', 'sizeByPct', 'sizeByConfinedWh', 'sizeByWh'],\n    formats: ['jpg', 'png'],\n    qualities: ['native', 'color', 'grey', 'bitonal']\n  }\n};\nIIIF_PROFILE_VALUES[Versions.VERSION2] = {\n  'level0': {\n    supports: [],\n    formats: ['jpg'],\n    qualities: ['default']\n  },\n  'level1': {\n    supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n    formats: ['jpg'],\n    qualities: ['default']\n  },\n  'level2': {\n    supports: ['regionByPx', 'regionByPct', 'sizeByW', 'sizeByH', 'sizeByPct', 'sizeByConfinedWh', 'sizeByDistortedWh', 'sizeByWh'],\n    formats: ['jpg', 'png'],\n    qualities: ['default', 'bitonal']\n  }\n};\nIIIF_PROFILE_VALUES[Versions.VERSION3] = {\n  'level0': {\n    supports: [],\n    formats: ['jpg'],\n    qualities: ['default']\n  },\n  'level1': {\n    supports: ['regionByPx', 'regionSquare', 'sizeByW', 'sizeByH', 'sizeByWh'],\n    formats: ['jpg'],\n    qualities: ['default']\n  },\n  'level2': {\n    supports: ['regionByPx', 'regionSquare', 'regionByPct', 'sizeByW', 'sizeByH', 'sizeByPct', 'sizeByConfinedWh', 'sizeByWh'],\n    formats: ['jpg', 'png'],\n    qualities: ['default']\n  }\n};\nIIIF_PROFILE_VALUES['none'] = {\n  'none': {\n    supports: [],\n    formats: [],\n    qualities: []\n  }\n};\nvar COMPLIANCE_VERSION1 = /^https?:\\/\\/library\\.stanford\\.edu\\/iiif\\/image-api\\/(?:1\\.1\\/)?compliance\\.html#level[0-2]$/;\nvar COMPLIANCE_VERSION2 = /^https?:\\/\\/iiif\\.io\\/api\\/image\\/2\\/level[0-2](?:\\.json)?$/;\nvar COMPLIANCE_VERSION3 = /(^https?:\\/\\/iiif\\.io\\/api\\/image\\/3\\/level[0-2](?:\\.json)?$)|(^level[0-2]$)/;\n\nfunction generateVersion1Options(iiifInfo) {\n  var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(); // Version 1.0 and 1.1 do not require a profile.\n\n  if (levelProfile === undefined) {\n    levelProfile = IIIF_PROFILE_VALUES[Versions.VERSION1]['level0'];\n  }\n\n  return {\n    url: iiifInfo.imageInfo['@id'] === undefined ? undefined : iiifInfo.imageInfo['@id'].replace(/\\/?(?:info\\.json)?$/g, ''),\n    supports: levelProfile.supports,\n    formats: __spreadArrays(levelProfile.formats, [iiifInfo.imageInfo.formats === undefined ? [] : iiifInfo.imageInfo.formats]),\n    qualities: __spreadArrays(levelProfile.qualities, [iiifInfo.imageInfo.qualities === undefined ? [] : iiifInfo.imageInfo.qualities]),\n    resolutions: iiifInfo.imageInfo.scale_factors,\n    tileSize: iiifInfo.imageInfo.tile_width !== undefined ? iiifInfo.imageInfo.tile_height !== undefined ? [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_height] : [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_width] : iiifInfo.imageInfo.tile_height != undefined ? [iiifInfo.imageInfo.tile_height, iiifInfo.imageInfo.tile_height] : undefined\n  };\n}\n\nfunction generateVersion2Options(iiifInfo) {\n  var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(),\n      additionalProfile = Array.isArray(iiifInfo.imageInfo.profile) && iiifInfo.imageInfo.profile.length > 1,\n      profileSupports = additionalProfile && iiifInfo.imageInfo.profile[1].supports ? iiifInfo.imageInfo.profile[1].supports : [],\n      profileFormats = additionalProfile && iiifInfo.imageInfo.profile[1].formats ? iiifInfo.imageInfo.profile[1].formats : [],\n      profileQualities = additionalProfile && iiifInfo.imageInfo.profile[1].qualities ? iiifInfo.imageInfo.profile[1].qualities : [];\n  return {\n    url: iiifInfo.imageInfo['@id'].replace(/\\/?(?:info\\.json)?$/g, ''),\n    sizes: iiifInfo.imageInfo.sizes === undefined ? undefined : iiifInfo.imageInfo.sizes.map(function (size) {\n      return [size.width, size.height];\n    }),\n    tileSize: iiifInfo.imageInfo.tiles === undefined ? undefined : [iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.width;\n    })[0], iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.height === undefined ? tile.width : tile.height;\n    })[0]],\n    resolutions: iiifInfo.imageInfo.tiles === undefined ? undefined : iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.scaleFactors;\n    })[0],\n    supports: __spreadArrays(levelProfile.supports, profileSupports),\n    formats: __spreadArrays(levelProfile.formats, profileFormats),\n    qualities: __spreadArrays(levelProfile.qualities, profileQualities)\n  };\n}\n\nfunction generateVersion3Options(iiifInfo) {\n  var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(),\n      formats = iiifInfo.imageInfo.extraFormats === undefined ? levelProfile.formats : __spreadArrays(levelProfile.formats, iiifInfo.imageInfo.extraFormats),\n      preferredFormat = iiifInfo.imageInfo.preferredFormats !== undefined && Array.isArray(iiifInfo.imageInfo.preferredFormats) && iiifInfo.imageInfo.preferredFormats.length > 0 ? iiifInfo.imageInfo.preferredFormats.filter(function (format) {\n    return ['jpg', 'png', 'gif'].includes(format);\n  }).reduce(function (acc, format) {\n    return acc === undefined && formats.includes(format) ? format : acc;\n  }, undefined) : undefined;\n  return {\n    url: iiifInfo.imageInfo['id'],\n    sizes: iiifInfo.imageInfo.sizes === undefined ? undefined : iiifInfo.imageInfo.sizes.map(function (size) {\n      return [size.width, size.height];\n    }),\n    tileSize: iiifInfo.imageInfo.tiles === undefined ? undefined : [iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.width;\n    })[0], iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.height;\n    })[0]],\n    resolutions: iiifInfo.imageInfo.tiles === undefined ? undefined : iiifInfo.imageInfo.tiles.map(function (tile) {\n      return tile.scaleFactors;\n    })[0],\n    supports: iiifInfo.imageInfo.extraFeatures === undefined ? levelProfile.supports : __spreadArrays(levelProfile.supports, iiifInfo.imageInfo.extraFeatures),\n    formats: formats,\n    qualities: iiifInfo.imageInfo.extraQualities === undefined ? levelProfile.qualities : __spreadArrays(levelProfile.qualities, iiifInfo.imageInfo.extraQualities),\n    preferredFormat: preferredFormat\n  };\n}\n\nvar versionFunctions = {};\nversionFunctions[Versions.VERSION1] = generateVersion1Options;\nversionFunctions[Versions.VERSION2] = generateVersion2Options;\nversionFunctions[Versions.VERSION3] = generateVersion3Options;\n/**\n * @classdesc\n * Format for transforming IIIF Image API image information responses into\n * IIIF tile source ready options\n *\n * @api\n */\n\nvar IIIFInfo =\n/** @class */\nfunction () {\n  /**\n   * @param {string|ImageInformationResponse} imageInfo\n   * Deserialized image information JSON response object or JSON response as string\n   */\n  function IIIFInfo(imageInfo) {\n    this.setImageInfo(imageInfo);\n  }\n  /**\n   * @param {string|ImageInformationResponse} imageInfo\n   * Deserialized image information JSON response object or JSON response as string\n   * @api\n   */\n\n\n  IIIFInfo.prototype.setImageInfo = function (imageInfo) {\n    if (typeof imageInfo == 'string') {\n      this.imageInfo = JSON.parse(imageInfo);\n    } else {\n      this.imageInfo = imageInfo;\n    }\n  };\n  /**\n   * @returns {Versions} Major IIIF version.\n   * @api\n   */\n\n\n  IIIFInfo.prototype.getImageApiVersion = function () {\n    if (this.imageInfo === undefined) {\n      return;\n    }\n\n    var context = this.imageInfo['@context'] || 'ol-no-context';\n\n    if (typeof context == 'string') {\n      context = [context];\n    }\n\n    for (var i = 0; i < context.length; i++) {\n      switch (context[i]) {\n        case 'http://library.stanford.edu/iiif/image-api/1.1/context.json':\n        case 'http://iiif.io/api/image/1/context.json':\n          return Versions.VERSION1;\n\n        case 'http://iiif.io/api/image/2/context.json':\n          return Versions.VERSION2;\n\n        case 'http://iiif.io/api/image/3/context.json':\n          return Versions.VERSION3;\n\n        case 'ol-no-context':\n          // Image API 1.0 has no '@context'\n          if (this.getComplianceLevelEntryFromProfile(Versions.VERSION1) && this.imageInfo.identifier) {\n            return Versions.VERSION1;\n          }\n\n          break;\n\n        default:\n      }\n    }\n\n    assert(false, 61);\n  };\n  /**\n   * @param {Versions} version Optional IIIF image API version\n   * @returns {string} Compliance level as it appears in the IIIF image information\n   * response.\n   */\n\n\n  IIIFInfo.prototype.getComplianceLevelEntryFromProfile = function (version) {\n    if (this.imageInfo === undefined || this.imageInfo.profile === undefined) {\n      return;\n    }\n\n    if (version === undefined) {\n      version = this.getImageApiVersion();\n    }\n\n    switch (version) {\n      case Versions.VERSION1:\n        if (COMPLIANCE_VERSION1.test(this.imageInfo.profile)) {\n          return this.imageInfo.profile;\n        }\n\n        break;\n\n      case Versions.VERSION3:\n        if (COMPLIANCE_VERSION3.test(this.imageInfo.profile)) {\n          return this.imageInfo.profile;\n        }\n\n        break;\n\n      case Versions.VERSION2:\n        if (typeof this.imageInfo.profile === 'string' && COMPLIANCE_VERSION2.test(this.imageInfo.profile)) {\n          return this.imageInfo.profile;\n        }\n\n        if (Array.isArray(this.imageInfo.profile) && this.imageInfo.profile.length > 0 && typeof this.imageInfo.profile[0] === 'string' && COMPLIANCE_VERSION2.test(this.imageInfo.profile[0])) {\n          return this.imageInfo.profile[0];\n        }\n\n        break;\n\n      default:\n    }\n  };\n  /**\n   * @param {Versions} version Optional IIIF image API version\n   * @returns {string} Compliance level, on of 'level0', 'level1' or 'level2' or undefined\n   */\n\n\n  IIIFInfo.prototype.getComplianceLevelFromProfile = function (version) {\n    var complianceLevel = this.getComplianceLevelEntryFromProfile(version);\n\n    if (complianceLevel === undefined) {\n      return undefined;\n    }\n\n    var level = complianceLevel.match(/level[0-2](?:\\.json)?$/g);\n    return Array.isArray(level) ? level[0].replace('.json', '') : undefined;\n  };\n  /**\n   * @returns {SupportedFeatures} Image formats, qualities and region / size calculation\n   * methods that are supported by the IIIF service.\n   */\n\n\n  IIIFInfo.prototype.getComplianceLevelSupportedFeatures = function () {\n    if (this.imageInfo === undefined) {\n      return;\n    }\n\n    var version = this.getImageApiVersion();\n    var level = this.getComplianceLevelFromProfile(version);\n\n    if (level === undefined) {\n      return IIIF_PROFILE_VALUES['none']['none'];\n    }\n\n    return IIIF_PROFILE_VALUES[version][level];\n  };\n  /**\n   * @param {PreferredOptions=} opt_preferredOptions Optional options for preferred format and quality.\n   * @returns {import(\"../source/IIIF.js\").Options} IIIF tile source ready constructor options.\n   * @api\n   */\n\n\n  IIIFInfo.prototype.getTileSourceOptions = function (opt_preferredOptions) {\n    var options = opt_preferredOptions || {},\n        version = this.getImageApiVersion();\n\n    if (version === undefined) {\n      return;\n    }\n\n    var imageOptions = version === undefined ? undefined : versionFunctions[version](this);\n\n    if (imageOptions === undefined) {\n      return;\n    }\n\n    return {\n      url: imageOptions.url,\n      version: version,\n      size: [this.imageInfo.width, this.imageInfo.height],\n      sizes: imageOptions.sizes,\n      format: options.format !== undefined && imageOptions.formats.includes(options.format) ? options.format : imageOptions.preferredFormat !== undefined ? imageOptions.preferredFormat : 'jpg',\n      supports: imageOptions.supports,\n      quality: options.quality && imageOptions.qualities.includes(options.quality) ? options.quality : imageOptions.qualities.includes('native') ? 'native' : 'default',\n      resolutions: Array.isArray(imageOptions.resolutions) ? imageOptions.resolutions.sort(function (a, b) {\n        return b - a;\n      }) : undefined,\n      tileSize: imageOptions.tileSize\n    };\n  };\n\n  return IIIFInfo;\n}();\n\nexport default IIIFInfo;","map":{"version":3,"sources":["../src/format/IIIFInfo.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\n * @module ol/format/IIIFInfo\n */\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { assert } from '../asserts.js';\n/**\n * @typedef {Object} PreferredOptions\n * @property {string} [format] Preferred image format. Will be used if the image information\n * indicates support for that format.\n * @property {string} [quality] IIIF image qualitiy.  Will be used if the image information\n * indicates support for that quality.\n */\n/**\n * @typedef {Object} SupportedFeatures\n * @property {Array<string>} [supports] Supported IIIF image size and region\n * calculation features.\n * @property {Array<string>} [formats] Supported image formats.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n */\n/**\n * @typedef {Object} TileInfo\n * @property {Array<number>} scaleFactors Supported resolution scaling factors.\n * @property {number} width Tile width in pixels.\n * @property {number} [height] Tile height in pixels. Same as tile width if height is\n * not given.\n */\n/**\n * @typedef {Object} IiifProfile\n * @property {Array<string>} [formats] Supported image formats for the image service.\n * @property {Array<string>} [qualities] Supported IIIF image qualities.\n * @property {Array<string>} [supports] Supported features.\n * @property {number} [maxArea] Maximum area (pixels) available for this image service.\n * @property {number} [maxHeight] Maximum height.\n * @property {number} [maxWidth] Maximum width.\n */\n/**\n * @typedef {Object<string,string|number|Array<number|string|IiifProfile>|Object<string, number>|TileInfo>}\n *    ImageInformationResponse\n */\n/**\n * Enum representing the major IIIF Image API versions\n * @enum {string}\n */\nexport var Versions = {\n    VERSION1: 'version1',\n    VERSION2: 'version2',\n    VERSION3: 'version3',\n};\n/**\n * Supported image formats, qualities and supported region / size calculation features\n * for different image API versions and compliance levels\n * @const\n * @type {Object<string, Object<string, SupportedFeatures>>}\n */\nvar IIIF_PROFILE_VALUES = {};\nIIIF_PROFILE_VALUES[Versions.VERSION1] = {\n    'level0': {\n        supports: [],\n        formats: [],\n        qualities: ['native'],\n    },\n    'level1': {\n        supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n        formats: ['jpg'],\n        qualities: ['native'],\n    },\n    'level2': {\n        supports: [\n            'regionByPx',\n            'regionByPct',\n            'sizeByW',\n            'sizeByH',\n            'sizeByPct',\n            'sizeByConfinedWh',\n            'sizeByWh',\n        ],\n        formats: ['jpg', 'png'],\n        qualities: ['native', 'color', 'grey', 'bitonal'],\n    },\n};\nIIIF_PROFILE_VALUES[Versions.VERSION2] = {\n    'level0': {\n        supports: [],\n        formats: ['jpg'],\n        qualities: ['default'],\n    },\n    'level1': {\n        supports: ['regionByPx', 'sizeByW', 'sizeByH', 'sizeByPct'],\n        formats: ['jpg'],\n        qualities: ['default'],\n    },\n    'level2': {\n        supports: [\n            'regionByPx',\n            'regionByPct',\n            'sizeByW',\n            'sizeByH',\n            'sizeByPct',\n            'sizeByConfinedWh',\n            'sizeByDistortedWh',\n            'sizeByWh',\n        ],\n        formats: ['jpg', 'png'],\n        qualities: ['default', 'bitonal'],\n    },\n};\nIIIF_PROFILE_VALUES[Versions.VERSION3] = {\n    'level0': {\n        supports: [],\n        formats: ['jpg'],\n        qualities: ['default'],\n    },\n    'level1': {\n        supports: ['regionByPx', 'regionSquare', 'sizeByW', 'sizeByH', 'sizeByWh'],\n        formats: ['jpg'],\n        qualities: ['default'],\n    },\n    'level2': {\n        supports: [\n            'regionByPx',\n            'regionSquare',\n            'regionByPct',\n            'sizeByW',\n            'sizeByH',\n            'sizeByPct',\n            'sizeByConfinedWh',\n            'sizeByWh',\n        ],\n        formats: ['jpg', 'png'],\n        qualities: ['default'],\n    },\n};\nIIIF_PROFILE_VALUES['none'] = {\n    'none': {\n        supports: [],\n        formats: [],\n        qualities: [],\n    },\n};\nvar COMPLIANCE_VERSION1 = /^https?:\\/\\/library\\.stanford\\.edu\\/iiif\\/image-api\\/(?:1\\.1\\/)?compliance\\.html#level[0-2]$/;\nvar COMPLIANCE_VERSION2 = /^https?:\\/\\/iiif\\.io\\/api\\/image\\/2\\/level[0-2](?:\\.json)?$/;\nvar COMPLIANCE_VERSION3 = /(^https?:\\/\\/iiif\\.io\\/api\\/image\\/3\\/level[0-2](?:\\.json)?$)|(^level[0-2]$)/;\nfunction generateVersion1Options(iiifInfo) {\n    var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures();\n    // Version 1.0 and 1.1 do not require a profile.\n    if (levelProfile === undefined) {\n        levelProfile = IIIF_PROFILE_VALUES[Versions.VERSION1]['level0'];\n    }\n    return {\n        url: iiifInfo.imageInfo['@id'] === undefined\n            ? undefined\n            : iiifInfo.imageInfo['@id'].replace(/\\/?(?:info\\.json)?$/g, ''),\n        supports: levelProfile.supports,\n        formats: __spreadArrays(levelProfile.formats, [\n            iiifInfo.imageInfo.formats === undefined\n                ? []\n                : iiifInfo.imageInfo.formats,\n        ]),\n        qualities: __spreadArrays(levelProfile.qualities, [\n            iiifInfo.imageInfo.qualities === undefined\n                ? []\n                : iiifInfo.imageInfo.qualities,\n        ]),\n        resolutions: iiifInfo.imageInfo.scale_factors,\n        tileSize: iiifInfo.imageInfo.tile_width !== undefined\n            ? iiifInfo.imageInfo.tile_height !== undefined\n                ? [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_height]\n                : [iiifInfo.imageInfo.tile_width, iiifInfo.imageInfo.tile_width]\n            : iiifInfo.imageInfo.tile_height != undefined\n                ? [iiifInfo.imageInfo.tile_height, iiifInfo.imageInfo.tile_height]\n                : undefined,\n    };\n}\nfunction generateVersion2Options(iiifInfo) {\n    var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(), additionalProfile = Array.isArray(iiifInfo.imageInfo.profile) &&\n        iiifInfo.imageInfo.profile.length > 1, profileSupports = additionalProfile && iiifInfo.imageInfo.profile[1].supports\n        ? iiifInfo.imageInfo.profile[1].supports\n        : [], profileFormats = additionalProfile && iiifInfo.imageInfo.profile[1].formats\n        ? iiifInfo.imageInfo.profile[1].formats\n        : [], profileQualities = additionalProfile && iiifInfo.imageInfo.profile[1].qualities\n        ? iiifInfo.imageInfo.profile[1].qualities\n        : [];\n    return {\n        url: iiifInfo.imageInfo['@id'].replace(/\\/?(?:info\\.json)?$/g, ''),\n        sizes: iiifInfo.imageInfo.sizes === undefined\n            ? undefined\n            : iiifInfo.imageInfo.sizes.map(function (size) {\n                return [size.width, size.height];\n            }),\n        tileSize: iiifInfo.imageInfo.tiles === undefined\n            ? undefined\n            : [\n                iiifInfo.imageInfo.tiles.map(function (tile) {\n                    return tile.width;\n                })[0],\n                iiifInfo.imageInfo.tiles.map(function (tile) {\n                    return tile.height === undefined ? tile.width : tile.height;\n                })[0],\n            ],\n        resolutions: iiifInfo.imageInfo.tiles === undefined\n            ? undefined\n            : iiifInfo.imageInfo.tiles.map(function (tile) {\n                return tile.scaleFactors;\n            })[0],\n        supports: __spreadArrays(levelProfile.supports, profileSupports),\n        formats: __spreadArrays(levelProfile.formats, profileFormats),\n        qualities: __spreadArrays(levelProfile.qualities, profileQualities),\n    };\n}\nfunction generateVersion3Options(iiifInfo) {\n    var levelProfile = iiifInfo.getComplianceLevelSupportedFeatures(), formats = iiifInfo.imageInfo.extraFormats === undefined\n        ? levelProfile.formats\n        : __spreadArrays(levelProfile.formats, iiifInfo.imageInfo.extraFormats), preferredFormat = iiifInfo.imageInfo.preferredFormats !== undefined &&\n        Array.isArray(iiifInfo.imageInfo.preferredFormats) &&\n        iiifInfo.imageInfo.preferredFormats.length > 0\n        ? iiifInfo.imageInfo.preferredFormats\n            .filter(function (format) {\n            return ['jpg', 'png', 'gif'].includes(format);\n        })\n            .reduce(function (acc, format) {\n            return acc === undefined && formats.includes(format)\n                ? format\n                : acc;\n        }, undefined)\n        : undefined;\n    return {\n        url: iiifInfo.imageInfo['id'],\n        sizes: iiifInfo.imageInfo.sizes === undefined\n            ? undefined\n            : iiifInfo.imageInfo.sizes.map(function (size) {\n                return [size.width, size.height];\n            }),\n        tileSize: iiifInfo.imageInfo.tiles === undefined\n            ? undefined\n            : [\n                iiifInfo.imageInfo.tiles.map(function (tile) {\n                    return tile.width;\n                })[0],\n                iiifInfo.imageInfo.tiles.map(function (tile) {\n                    return tile.height;\n                })[0],\n            ],\n        resolutions: iiifInfo.imageInfo.tiles === undefined\n            ? undefined\n            : iiifInfo.imageInfo.tiles.map(function (tile) {\n                return tile.scaleFactors;\n            })[0],\n        supports: iiifInfo.imageInfo.extraFeatures === undefined\n            ? levelProfile.supports\n            : __spreadArrays(levelProfile.supports, iiifInfo.imageInfo.extraFeatures),\n        formats: formats,\n        qualities: iiifInfo.imageInfo.extraQualities === undefined\n            ? levelProfile.qualities\n            : __spreadArrays(levelProfile.qualities, iiifInfo.imageInfo.extraQualities),\n        preferredFormat: preferredFormat,\n    };\n}\nvar versionFunctions = {};\nversionFunctions[Versions.VERSION1] = generateVersion1Options;\nversionFunctions[Versions.VERSION2] = generateVersion2Options;\nversionFunctions[Versions.VERSION3] = generateVersion3Options;\n/**\n * @classdesc\n * Format for transforming IIIF Image API image information responses into\n * IIIF tile source ready options\n *\n * @api\n */\nvar IIIFInfo = /** @class */ (function () {\n    /**\n     * @param {string|ImageInformationResponse} imageInfo\n     * Deserialized image information JSON response object or JSON response as string\n     */\n    function IIIFInfo(imageInfo) {\n        this.setImageInfo(imageInfo);\n    }\n    /**\n     * @param {string|ImageInformationResponse} imageInfo\n     * Deserialized image information JSON response object or JSON response as string\n     * @api\n     */\n    IIIFInfo.prototype.setImageInfo = function (imageInfo) {\n        if (typeof imageInfo == 'string') {\n            this.imageInfo = JSON.parse(imageInfo);\n        }\n        else {\n            this.imageInfo = imageInfo;\n        }\n    };\n    /**\n     * @returns {Versions} Major IIIF version.\n     * @api\n     */\n    IIIFInfo.prototype.getImageApiVersion = function () {\n        if (this.imageInfo === undefined) {\n            return;\n        }\n        var context = this.imageInfo['@context'] || 'ol-no-context';\n        if (typeof context == 'string') {\n            context = [context];\n        }\n        for (var i = 0; i < context.length; i++) {\n            switch (context[i]) {\n                case 'http://library.stanford.edu/iiif/image-api/1.1/context.json':\n                case 'http://iiif.io/api/image/1/context.json':\n                    return Versions.VERSION1;\n                case 'http://iiif.io/api/image/2/context.json':\n                    return Versions.VERSION2;\n                case 'http://iiif.io/api/image/3/context.json':\n                    return Versions.VERSION3;\n                case 'ol-no-context':\n                    // Image API 1.0 has no '@context'\n                    if (this.getComplianceLevelEntryFromProfile(Versions.VERSION1) &&\n                        this.imageInfo.identifier) {\n                        return Versions.VERSION1;\n                    }\n                    break;\n                default:\n            }\n        }\n        assert(false, 61);\n    };\n    /**\n     * @param {Versions} version Optional IIIF image API version\n     * @returns {string} Compliance level as it appears in the IIIF image information\n     * response.\n     */\n    IIIFInfo.prototype.getComplianceLevelEntryFromProfile = function (version) {\n        if (this.imageInfo === undefined || this.imageInfo.profile === undefined) {\n            return;\n        }\n        if (version === undefined) {\n            version = this.getImageApiVersion();\n        }\n        switch (version) {\n            case Versions.VERSION1:\n                if (COMPLIANCE_VERSION1.test(this.imageInfo.profile)) {\n                    return this.imageInfo.profile;\n                }\n                break;\n            case Versions.VERSION3:\n                if (COMPLIANCE_VERSION3.test(this.imageInfo.profile)) {\n                    return this.imageInfo.profile;\n                }\n                break;\n            case Versions.VERSION2:\n                if (typeof this.imageInfo.profile === 'string' &&\n                    COMPLIANCE_VERSION2.test(this.imageInfo.profile)) {\n                    return this.imageInfo.profile;\n                }\n                if (Array.isArray(this.imageInfo.profile) &&\n                    this.imageInfo.profile.length > 0 &&\n                    typeof this.imageInfo.profile[0] === 'string' &&\n                    COMPLIANCE_VERSION2.test(this.imageInfo.profile[0])) {\n                    return this.imageInfo.profile[0];\n                }\n                break;\n            default:\n        }\n    };\n    /**\n     * @param {Versions} version Optional IIIF image API version\n     * @returns {string} Compliance level, on of 'level0', 'level1' or 'level2' or undefined\n     */\n    IIIFInfo.prototype.getComplianceLevelFromProfile = function (version) {\n        var complianceLevel = this.getComplianceLevelEntryFromProfile(version);\n        if (complianceLevel === undefined) {\n            return undefined;\n        }\n        var level = complianceLevel.match(/level[0-2](?:\\.json)?$/g);\n        return Array.isArray(level) ? level[0].replace('.json', '') : undefined;\n    };\n    /**\n     * @returns {SupportedFeatures} Image formats, qualities and region / size calculation\n     * methods that are supported by the IIIF service.\n     */\n    IIIFInfo.prototype.getComplianceLevelSupportedFeatures = function () {\n        if (this.imageInfo === undefined) {\n            return;\n        }\n        var version = this.getImageApiVersion();\n        var level = this.getComplianceLevelFromProfile(version);\n        if (level === undefined) {\n            return IIIF_PROFILE_VALUES['none']['none'];\n        }\n        return IIIF_PROFILE_VALUES[version][level];\n    };\n    /**\n     * @param {PreferredOptions=} opt_preferredOptions Optional options for preferred format and quality.\n     * @returns {import(\"../source/IIIF.js\").Options} IIIF tile source ready constructor options.\n     * @api\n     */\n    IIIFInfo.prototype.getTileSourceOptions = function (opt_preferredOptions) {\n        var options = opt_preferredOptions || {}, version = this.getImageApiVersion();\n        if (version === undefined) {\n            return;\n        }\n        var imageOptions = version === undefined ? undefined : versionFunctions[version](this);\n        if (imageOptions === undefined) {\n            return;\n        }\n        return {\n            url: imageOptions.url,\n            version: version,\n            size: [this.imageInfo.width, this.imageInfo.height],\n            sizes: imageOptions.sizes,\n            format: options.format !== undefined &&\n                imageOptions.formats.includes(options.format)\n                ? options.format\n                : imageOptions.preferredFormat !== undefined\n                    ? imageOptions.preferredFormat\n                    : 'jpg',\n            supports: imageOptions.supports,\n            quality: options.quality && imageOptions.qualities.includes(options.quality)\n                ? options.quality\n                : imageOptions.qualities.includes('native')\n                    ? 'native'\n                    : 'default',\n            resolutions: Array.isArray(imageOptions.resolutions)\n                ? imageOptions.resolutions.sort(function (a, b) {\n                    return b - a;\n                })\n                : undefined,\n            tileSize: imageOptions.tileSize,\n        };\n    };\n    return IIIFInfo;\n}());\nexport default IIIFInfo;\n//# sourceMappingURL=IIIFInfo.js.map"]},"metadata":{},"sourceType":"module"}